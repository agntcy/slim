# Copyright AGNTCY Contributors (https://github.com/agntcy)
# SPDX-License-Identifier: Apache-2.0

---
version: "3"

includes:
  control-plane:
    taskfile: ../control-plane/Taskfile.yaml
    flatten: true
    dir: ../control-plane
    internal: true
  data-plane:
    taskfile: ../data-plane/Taskfile.yaml
    flatten: true
    dir: ../data-plane
    internal: true

silent: true

tasks:
  default:
    cmds:
      - task -l

  tests:integration:
    desc: "Run integration tests"
    vars:
      USE_LOCAL_BINDINGS: '{{.USE_LOCAL_BINDINGS | default "false"}}'
      FORCE_LOCAL_BINDINGS: '{{.FORCE_LOCAL_BINDINGS | default "false"}}'
    deps:
      - data-plane:build
      - data-plane:slimctl:build
      - task: control-plane:build
        vars:
          USE_LOCAL_BINDINGS: "{{.USE_LOCAL_BINDINGS}}"
          FORCE_LOCAL_BINDINGS: "{{.FORCE_LOCAL_BINDINGS}}"
    cmds:
      - go -C ./integration test -v -failfast -test.v -test.paniconexit0 -ginkgo.timeout 5m -timeout 5m -ginkgo.v .

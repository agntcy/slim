# Copyright AGNTCY Contributors (https://github.com/agntcy)
# SPDX-License-Identifier: Apache-2.0

# Example: Environment Variable Override Configuration
# This demonstrates the full power of CLI flag overrides using env vars
# All values have sensible defaults - works without any environment setup

runtime:
  n_cores: 0
  thread_name: "${env:SLIM_THREAD_NAME:-slim-worker}"
  drain_timeout: "${env:SLIM_DRAIN_TIMEOUT:-10s}"

tracing:
  log_level: "${env:SLIM_LOG_LEVEL:-info}"  # Note: RUST_LOG overrides this
  display_thread_names: true
  display_thread_ids: true

services:
  slim/0:
    dataplane:
      servers:
        - endpoint: "${env:SLIM_ENDPOINT:-127.0.0.1:8080}"
          tls:
            insecure: "${env:SLIM_TLS_INSECURE:-true}"
            source:
              type: file
              cert: "${env:SLIM_TLS_CERT:-testdata/certs/server-cert.pem}"
              key: "${env:SLIM_TLS_KEY:-testdata/certs/server-key.pem}"
      clients: []

# Usage Examples:
#
# 1. Default behavior (no flags, no env vars):
#    slimctl slim start --config examples/env-override.yaml
#    Result: Server on 127.0.0.1:8080, insecure mode
#
# 2. Override endpoint via CLI:
#    slimctl slim start --config examples/env-override.yaml \
#      --endpoint 0.0.0.0:8443
#    Result: Server on 0.0.0.0:8443, insecure mode
#
# 3. Override with TLS:
#    slimctl slim start --config examples/env-override.yaml \
#      --endpoint 0.0.0.0:8443 \
#      --tls-cert /path/to/cert.pem \
#      --tls-key /path/to/key.pem
#    Result: Server on 0.0.0.0:8443, TLS enabled
#
# 4. Override via environment variables directly:
#    export SLIM_ENDPOINT=127.0.0.1:9090
#    export SLIM_TLS_INSECURE=false
#    export SLIM_TLS_CERT=/etc/ssl/certs/server.pem
#    export SLIM_TLS_KEY=/etc/ssl/private/server-key.pem
#    slimctl slim start --config examples/env-override.yaml
#
# 5. Debug logging (RUST_LOG takes precedence):
#    RUST_LOG=debug slimctl slim start \
#      --config examples/env-override.yaml
#
# How it works:
# - CLI flags are converted to env vars: --endpoint â†’ SLIM_ENDPOINT
# - Bindings resolve ${env:VAR:-default} when loading config
# - If env var is set, it overrides the default
# - If env var is not set, the default value is used

# Copyright AGNTCY Contributors (https://github.com/agntcy)
# SPDX-License-Identifier: Apache-2.0

[target.'cfg(all())']
rustflags = ["--cfg", "mls_build_async"]

[target.aarch64-unknown-linux-gnu]
linker="aarch64-linux-gnu-gcc"

[target.x86_64-unknown-linux-gnu]
linker="x86_64-linux-gnu-gcc"

# iOS: use linker wrapper to replace rustc's -target arm64-apple-ios10.0.0 with 13.4
# (needed for ___chkstk_darwin and to match podspec platforms :ios => "13.4")
# Path relative to the package being built (bindings/rust) so CI and local find the script.
[target.aarch64-apple-ios]
linker = "../../.cargo/clang-ios-linker-wrapper.sh"
rustflags = ["-C", "link-arg=-mios-version-min=13.4"]

[target.aarch64-apple-ios-sim]
linker = "../../.cargo/clang-ios-linker-wrapper.sh"
rustflags = ["-C", "link-arg=-mios-simulator-version-min=13.4"]

[env]
# CFLAGS suppresses macro redefinition warnings that occur when system headers
# are mixed with Zig's headers (common with Windows cross-compilation).
CFLAGS_x86_64_pc_windows_gnu = "-Wno-macro-redefined"

CC_x86_64_unknown_linux_gnu = "clang-19"
AR_x86_64_unknown_linux_gnu = "llvm-ar-19"
STRIP_x86_64_unknown_linux_gnu = "llvm-strip-19"

CC_aarch64_unknown_linux_gnu = "clang-19"
AR_aarch64_unknown_linux_gnu = "llvm-ar-19"
STRIP_aarch64_unknown_linux_gnu = "llvm-strip-19"

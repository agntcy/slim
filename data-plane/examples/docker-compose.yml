services:
  # Slim server
  slim-server:
    build:
      context: ../..
      dockerfile: ./data-plane/Dockerfile
      target: slim-release
    entrypoint: ["/slim"]
    command: ["--config", "/config/server-config.yaml"]
    ports:
      - "50001:50001"
    networks:
      - slim-network
    volumes:
      - ../config/base/server-config.yaml:/config/server-config.yaml

  # Mock app server
  mock-app-server:
    build:
      context: ../..
      dockerfile: ./data-plane/examples/Dockerfile.mock-app
      target: mock-app-server
    depends_on:
      - slim-server
    networks:
      - slim-network
    volumes:
      - ./config/docker-client-config.yaml:/config/client-config.yaml

  # Mock app client
  mock-app-client:
    build:
      context: ../..
      dockerfile: ./data-plane/examples/Dockerfile.mock-app
      target: mock-app-client
    depends_on:
      - slim-server
      - mock-app-server
    networks:
      - slim-network
    volumes:
      - ./config/docker-client-config.yaml:/config/client-config.yaml

networks:
  slim-network:
    driver: bridge